<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:Memorandum.Desktop.Controls"
             x:Class="Memorandum.Desktop.Views.GraphView"
             Background="{StaticResource AppBackground}">
  <Grid RowDefinitions="Auto,*" MinWidth="600" MinHeight="400">
    <Border Grid.Row="0" Classes="GraphHeader">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center" Margin="8,0">
          <Button x:Name="BackButton" Content="Назад" Classes="PrimaryButton" MinWidth="80" Click="OnBackClick" />
          <TextBlock Text="Граф связей" FontWeight="SemiBold" FontSize="18" Foreground="{StaticResource PrimaryForeground}" VerticalAlignment="Center" />
        </StackPanel>
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center" Margin="8,0">
          <Button x:Name="ZoomOutButton" Classes="GraphToolButton" Content="-" ToolTip.Tip="Уменьшить" Click="OnZoomOutClick" />
          <Border Background="{StaticResource SurfaceBackground}" BorderBrush="{StaticResource GraphBorderBrush}" BorderThickness="1" Padding="12,8" CornerRadius="4" VerticalAlignment="Center">
            <TextBlock x:Name="ZoomText" Text="100%" MinWidth="60" HorizontalAlignment="Center" Foreground="{StaticResource PrimaryForeground}" />
          </Border>
          <Button x:Name="ZoomInButton" Classes="GraphToolButton" Content="+" ToolTip.Tip="Увеличить" Click="OnZoomInClick" />
          <Button x:Name="ResetButton" Classes="GraphToolButton" Content="Сброс" ToolTip.Tip="Сбросить вид" Click="OnResetClick" />
        </StackPanel>
      </Grid>
    </Border>

    <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
      <Border Grid.Column="0" Background="{StaticResource SurfaceBackground}" Margin="0">
        <Grid>
          <controls:GraphCanvas x:Name="GraphCanvas"
                               ZoomChanged="OnGraphZoomChanged"
                               OffsetChanged="OnGraphOffsetChanged"
                               SelectedNodeChanged="OnGraphSelectedNodeChanged" />
          <Border HorizontalAlignment="Left" VerticalAlignment="Top" Margin="16" Classes="GraphLegend">
            <StackPanel Spacing="12">
              <TextBlock Text="Легенда" Classes="GraphLegendTitle" Foreground="{StaticResource PrimaryForeground}" />
              <StackPanel Spacing="8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Border Width="24" Height="24" CornerRadius="12" Background="{StaticResource GraphLegendNoteBackground}">
                    <TextBlock Text="N" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource PrimaryForeground}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                  </Border>
                  <TextBlock Text="Заметка" FontSize="14" Foreground="{StaticResource PrimaryForeground}" VerticalAlignment="Center" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Border Width="24" Height="24" CornerRadius="12" Background="{StaticResource GraphLegendFolderBackground}">
                    <TextBlock Text="F" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource PrimaryForeground}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                  </Border>
                  <TextBlock Text="Папка" FontSize="14" Foreground="{StaticResource PrimaryForeground}" VerticalAlignment="Center" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Border Width="24" Height="24" CornerRadius="12" Background="{StaticResource GraphLegendTagBackground}">
                    <TextBlock Text="T" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource PrimaryForeground}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                  </Border>
                  <TextBlock Text="Тег" FontSize="14" Foreground="{StaticResource PrimaryForeground}" VerticalAlignment="Center" />
                </StackPanel>
              </StackPanel>
              <Border BorderBrush="{StaticResource GraphBorderBrush}" BorderThickness="0,1,0,0" Padding="0,8,0,0" Margin="0,4,0,0">
                <StackPanel Spacing="4">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <Border Width="32" Height="2" Background="#6b7280" VerticalAlignment="Center" />
                    <TextBlock Text="В папке" FontSize="12" Foreground="{StaticResource GraphLabelSecondary}" VerticalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <Border Width="32" Height="2" BorderBrush="#6b7280" BorderThickness="0,2,0,0" VerticalAlignment="Center" />
                    <TextBlock Text="Имеет тег" FontSize="12" Foreground="{StaticResource GraphLabelSecondary}" VerticalAlignment="Center" />
                  </StackPanel>
                </StackPanel>
              </Border>
            </StackPanel>
          </Border>
          <Border HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="16" Classes="GraphHint">
            <TextBlock Text="Колесо мыши — масштаб; перетаскивание фона — перемещение по графу; перетаскивание вершины — сдвиг вершины для читаемости." Classes="GraphCaption" />
          </Border>
        </Grid>
      </Border>

      <Border x:Name="SidePanel" Grid.Column="1" MinWidth="280" MaxWidth="400" Width="320" Classes="GraphSidePanel" IsVisible="False">
        <Grid RowDefinitions="Auto,*">
          <Border Grid.Row="0" Padding="24,16" BorderBrush="{StaticResource GraphBorderBrush}" BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Информация" FontWeight="SemiBold" FontSize="18" Foreground="{StaticResource PrimaryForeground}" VerticalAlignment="Center" />
              <Button Grid.Column="1" Content="Закрыть" Classes="GraphLinkButton" Click="OnCloseSidePanelClick" />
            </Grid>
          </Border>
          <ScrollViewer Grid.Row="1" Padding="24">
            <StackPanel x:Name="SidePanelContent" Spacing="16">
              <StackPanel>
                <TextBlock Text="Тип" Classes="GraphLabelSecondary" Margin="0,0,0,4" />
                <TextBlock x:Name="NodeTypeText" FontSize="14" Foreground="{StaticResource PrimaryForeground}" />
              </StackPanel>
              <StackPanel>
                <TextBlock Text="Название" Classes="GraphLabelSecondary" Margin="0,0,0,4" />
                <TextBlock x:Name="NodeLabelText" FontWeight="SemiBold" FontSize="14" Foreground="{StaticResource PrimaryForeground}" />
              </StackPanel>
              <StackPanel>
                <TextBlock Text="Цвет" Classes="GraphLabelSecondary" Margin="0,0,0,4" />
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Border x:Name="NodeColorPreview" Width="32" Height="32" CornerRadius="4" />
                  <TextBlock x:Name="NodeColorText" FontSize="14" Foreground="{StaticResource PrimaryForeground}" VerticalAlignment="Center" />
                </StackPanel>
              </StackPanel>
              <StackPanel>
                <TextBlock Text="Связи" Classes="GraphLabelSecondary" Margin="0,0,0,8" />
                <StackPanel x:Name="ConnectionsStack" Spacing="4" />
              </StackPanel>
              <Button x:Name="OpenNoteButton" Content="Открыть заметку" IsVisible="False" Classes="PrimaryButton" Click="OnOpenNoteClick" />
            </StackPanel>
          </ScrollViewer>
        </Grid>
      </Border>
    </Grid>
  </Grid>
</UserControl>
